<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Career Intelligence — Admin Preview</title>
  <style>
    :root {
      --bg: #fafafa;
      --surface: #ffffff;
      --text: #1a1a1a;
      --muted: #666;
      --border: #e0e0e0;
      --accent: #2c5282;
      --accent-light: #ebf4ff;
      --q1-color: #2c5282;
      --q2-color: #6b46c1;
      --q3-color: #b7791f;
      --q4-color: #276749;
      --q5-color: #c53030;
      --radius: 8px;
      --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font);
      font-size: 15px;
      line-height: 1.6;
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
    }

    /* --- Layout --- */
    .admin-header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 24px 32px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .admin-header h1 { margin: 0 0 4px; font-size: 22px; font-weight: 600; }
    .admin-header p { margin: 0; color: var(--muted); font-size: 14px; }

    .admin-nav {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .admin-nav a {
      padding: 6px 14px;
      font-size: 13px;
      font-weight: 500;
      border-radius: 20px;
      text-decoration: none;
      color: var(--accent);
      background: var(--accent-light);
      transition: background 0.2s;
    }
    .admin-nav a:hover { background: #d4e6ff; }

    .admin-body {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 32px 80px;
    }

    /* --- Section --- */
    .section { margin-bottom: 48px; }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-subtitle {
      color: var(--muted);
      font-size: 13px;
      margin: 0 0 16px;
    }

    /* --- Cards --- */
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 16px;
      overflow: hidden;
    }
    .card-header {
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      user-select: none;
    }
    .card-header:hover { background: #f9f9f9; }
    .card-header .badge {
      display: inline-block;
      padding: 2px 10px;
      font-size: 11px;
      font-weight: 600;
      border-radius: 12px;
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }
    .card-header .title {
      font-size: 14px;
      font-weight: 600;
      flex: 1;
    }
    .card-header .chevron {
      font-size: 12px;
      color: var(--muted);
      transition: transform 0.2s;
    }
    .card-header .chevron.open { transform: rotate(90deg); }

    .card-body {
      padding: 20px;
      display: none;
    }
    .card-body.open { display: block; }

    /* --- Question text --- */
    .question-text {
      font-size: 15px;
      line-height: 1.65;
      padding: 14px 18px;
      background: #f7f7f5;
      border-radius: 6px;
      border-left: 3px solid var(--accent);
      margin-bottom: 12px;
    }

    /* --- Prompt text --- */
    .prompt-block {
      margin-top: 8px;
    }
    .prompt-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }
    .prompt-text {
      font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
      font-size: 13px;
      line-height: 1.7;
      padding: 16px 18px;
      background: #1a1a2e;
      color: #e0e0e0;
      border-radius: 6px;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-x: auto;
      max-height: 500px;
      overflow-y: auto;
    }
    .prompt-text .highlight { color: #ffd43b; }
    .prompt-text .placeholder { color: #63b3ed; }

    /* --- Routing table --- */
    .routing-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 12px;
    }
    .routing-table th {
      text-align: left;
      padding: 8px 12px;
      background: #f5f5f5;
      border-bottom: 2px solid var(--border);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--muted);
    }
    .routing-table td {
      padding: 8px 12px;
      border-bottom: 1px solid #eee;
      vertical-align: top;
    }
    .routing-table code {
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-size: 12px;
      background: #f0f0f0;
      padding: 2px 6px;
      border-radius: 3px;
      white-space: nowrap;
    }

    /* --- Config --- */
    .config-grid {
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 8px 16px;
      font-size: 14px;
    }
    .config-key {
      font-weight: 600;
      color: var(--muted);
    }
    .config-val {
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-size: 13px;
    }

    /* --- Flow diagram --- */
    .flow {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }
    .flow-step {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      color: #fff;
    }
    .flow-arrow {
      font-size: 18px;
      color: var(--muted);
    }
    .flow-label {
      font-size: 11px;
      color: var(--muted);
      display: block;
      text-align: center;
    }

    /* --- Badge colors --- */
    .bg-q1 { background: var(--q1-color); }
    .bg-q2 { background: var(--q2-color); }
    .bg-q3 { background: var(--q3-color); }
    .bg-q4 { background: var(--q4-color); }
    .bg-q5 { background: var(--q5-color); }
    .border-q1 { border-left-color: var(--q1-color); }
    .border-q2 { border-left-color: var(--q2-color); }
    .border-q3 { border-left-color: var(--q3-color); }
    .border-q4 { border-left-color: var(--q4-color); }
    .border-q5 { border-left-color: var(--q5-color); }

    /* --- File reference --- */
    .file-ref {
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-size: 12px;
      color: var(--muted);
      background: #f0f0f0;
      padding: 2px 8px;
      border-radius: 4px;
    }

    @media (max-width: 700px) {
      .admin-header { padding: 16px; }
      .admin-body { padding: 16px 16px 60px; }
      .prompt-text { font-size: 12px; padding: 12px; }
      .config-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<header class="admin-header">
  <h1>Career Intelligence Form — Admin Preview</h1>
  <p>Read-only view of all questions, routing logic, and AI prompts.
    To edit, modify <span class="file-ref">questions.js</span> and <span class="file-ref">prompts.js</span> and push.</p>
  <nav class="admin-nav">
    <a href="#flow">Flow</a>
    <a href="#config">Config</a>
    <a href="#q1">Q1 — Situation</a>
    <a href="#q2">Q2 — Adaptive</a>
    <a href="#q3">Q3 — Adaptive</a>
    <a href="#q4">Q4 — Synthesis</a>
    <a href="#q5">Q5 — Final</a>
  </nav>
</header>

<div class="admin-body" id="admin-content">
  <noscript><p>JavaScript is required to render this page.</p></noscript>
</div>

<script type="module">
import { QUESTIONS } from './questions.js';
import { PROMPTS } from './prompts.js';
import { CONFIG } from './config.js';

const $ = (tag, cls, html) => {
  const el = document.createElement(tag);
  if (cls) el.className = cls;
  if (html) el.innerHTML = html;
  return el;
};

const container = document.getElementById('admin-content');

/* ======= Conversation Flow ======= */
const flowSection = $('div', 'section');
flowSection.id = 'flow';
flowSection.innerHTML = `
  <h2 class="section-title">Conversation Flow</h2>
  <p class="section-subtitle">How the 5-step adaptive conversation works</p>
  <div class="flow">
    <div>
      <div class="flow-step bg-q1">Q1</div>
      <span class="flow-label">Fixed</span>
    </div>
    <span class="flow-arrow">&rarr;</span>
    <div>
      <div class="flow-step bg-q1" style="background:#888;font-size:11px;padding:6px 10px;">AI Routes</div>
      <span class="flow-label">JSON</span>
    </div>
    <span class="flow-arrow">&rarr;</span>
    <div>
      <div class="flow-step bg-q2">Q2</div>
      <span class="flow-label">1 of 5</span>
    </div>
    <span class="flow-arrow">&rarr;</span>
    <div>
      <div class="flow-step bg-q2" style="background:#888;font-size:11px;padding:6px 10px;">AI Routes</div>
      <span class="flow-label">JSON</span>
    </div>
    <span class="flow-arrow">&rarr;</span>
    <div>
      <div class="flow-step bg-q3">Q3</div>
      <span class="flow-label">1 of 5</span>
    </div>
    <span class="flow-arrow">&rarr;</span>
    <div>
      <div class="flow-step bg-q4">Q4</div>
      <span class="flow-label">Synthesis</span>
    </div>
    <span class="flow-arrow">&rarr;</span>
    <div>
      <div class="flow-step bg-q5">Q5</div>
      <span class="flow-label">Final</span>
    </div>
  </div>
  <p style="font-size:13px;color:var(--muted);">
    Q1 is always the same question. Based on the student's response, the AI selects
    one of 5 possible Q2 questions. After Q2, the AI selects one of 5 Q3 questions.
    Q4 synthesizes the full conversation. Q5 delivers the final output with an invitation.
  </p>
`;
container.appendChild(flowSection);

/* ======= Config ======= */
const configSection = $('div', 'section');
configSection.id = 'config';
configSection.innerHTML = `
  <h2 class="section-title">Configuration</h2>
  <p class="section-subtitle">From <span class="file-ref">config.js</span></p>
  <div class="config-grid">
    <span class="config-key">API Endpoint</span>
    <span class="config-val">${CONFIG.api_endpoint}</span>
    <span class="config-key">Model</span>
    <span class="config-val">${CONFIG.model}</span>
    <span class="config-key">Max Tokens</span>
    <span class="config-val">${CONFIG.max_tokens}</span>
    <span class="config-key">Form Version</span>
    <span class="config-val">${CONFIG.form_version}</span>
    <span class="config-key">Dates Placeholder</span>
    <span class="config-val">${CONFIG.dates_placeholder}</span>
    <span class="config-key">Link Placeholder</span>
    <span class="config-val">${CONFIG.link_placeholder}</span>
  </div>
`;
container.appendChild(configSection);

/* ======= Helper: highlight placeholders in prompt text ======= */
function highlightPrompt(text) {
  return text
    .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    .replace(/\{([^}]+)\}/g, '<span class="placeholder">{$1}</span>');
}

/* ======= Helper: build a collapsible card ======= */
function makeCard(badgeText, badgeClass, title, body, startOpen = false) {
  const card = $('div', 'card');
  const header = $('div', 'card-header');
  header.innerHTML = `
    <span class="badge ${badgeClass}">${badgeText}</span>
    <span class="title">${title}</span>
    <span class="chevron ${startOpen ? 'open' : ''}">&rsaquo;</span>
  `;
  const bodyEl = $('div', `card-body ${startOpen ? 'open' : ''}`);
  if (typeof body === 'string') {
    bodyEl.innerHTML = body;
  } else {
    bodyEl.appendChild(body);
  }
  header.addEventListener('click', () => {
    bodyEl.classList.toggle('open');
    header.querySelector('.chevron').classList.toggle('open');
  });
  card.appendChild(header);
  card.appendChild(bodyEl);
  return card;
}

/* ======= Q1 Section ======= */
const q1Section = $('div', 'section');
q1Section.id = 'q1';
q1Section.innerHTML = `
  <h2 class="section-title">Step 1 — Situation Check</h2>
  <p class="section-subtitle">Fixed question, always shown first.
    From <span class="file-ref">questions.js</span></p>
`;
q1Section.appendChild(makeCard('Q1', 'bg-q1', 'q1_situation', `
  <div class="question-text border-q1">${QUESTIONS.q1_situation.text}</div>
  <div class="prompt-block">
    <div class="prompt-label">System Prompt &mdash; sent to AI after student responds</div>
    <div class="prompt-text">${highlightPrompt(PROMPTS.q1)}</div>
  </div>
`, true));

/* Routing table */
q1Section.appendChild(makeCard('Routing', 'bg-q1', 'Q1 → Q2 Routing Options', `
  <p style="font-size:13px;color:var(--muted);margin:0 0 8px;">
    After reading the Q1 response, the AI picks one Q2 question:
  </p>
  <table class="routing-table">
    <tr><th>ID</th><th>When to use</th></tr>
    <tr><td><code>q2_active_unfocused</code></td><td>Student is actively searching but without clear strategy</td></tr>
    <tr><td><code>q2_alternative_path</code></td><td>Considering grad school, military, or non-employment path</td></tr>
    <tr><td><code>q2_paralyzed</code></td><td>Expresses anxiety, overwhelm, or paralysis</td></tr>
    <tr><td><code>q2_underemployed</code></td><td>Has a job/plan that's clearly settling</td></tr>
    <tr><td><code>q2_strategic</code></td><td>Already has a thoughtful, specific plan</td></tr>
  </table>
`, true));
container.appendChild(q1Section);

/* ======= Q2 Section ======= */
const q2Section = $('div', 'section');
q2Section.id = 'q2';
q2Section.innerHTML = `
  <h2 class="section-title">Step 2 — Adaptive Deep-Dive</h2>
  <p class="section-subtitle">One of 5 questions selected by AI routing.
    From <span class="file-ref">questions.js</span></p>
`;

const q2ids = ['q2_active_unfocused','q2_alternative_path','q2_paralyzed','q2_underemployed','q2_strategic'];
q2ids.forEach(id => {
  q2Section.appendChild(makeCard('Q2', 'bg-q2', id, `
    <div class="question-text border-q2">${QUESTIONS[id].text}</div>
  `));
});
q2Section.appendChild(makeCard('Prompt', 'bg-q2', 'Q2 System Prompt (shared by all Q2 variants)', `
  <div class="prompt-block">
    <div class="prompt-label">System Prompt &mdash; includes Q1 context via template variables</div>
    <div class="prompt-text">${highlightPrompt(PROMPTS.q2)}</div>
  </div>
`));

/* Q2 → Q3 routing */
q2Section.appendChild(makeCard('Routing', 'bg-q2', 'Q2 → Q3 Routing Options', `
  <table class="routing-table">
    <tr><th>ID</th><th>When to use</th></tr>
    <tr><td><code>q3_credentials_only</code></td><td>No differentiating experiences yet</td></tr>
    <tr><td><code>q3_has_experience_unframed</code></td><td>Mentioned experience but generically</td></tr>
    <tr><td><code>q3_strong_self_knowledge</code></td><td>Self-aware but not market-connected</td></tr>
    <tr><td><code>q3_avoidant_needs_grounding</code></td><td>Vague/deflective, needs concrete anchor</td></tr>
    <tr><td><code>q3_already_strategic</code></td><td>Already strategic, push toward intangible value</td></tr>
  </table>
`));
container.appendChild(q2Section);

/* ======= Q3 Section ======= */
const q3Section = $('div', 'section');
q3Section.id = 'q3';
q3Section.innerHTML = `
  <h2 class="section-title">Step 3 — Experience Probe</h2>
  <p class="section-subtitle">One of 5 questions selected by AI routing.
    From <span class="file-ref">questions.js</span></p>
`;

const q3ids = ['q3_credentials_only','q3_has_experience_unframed','q3_strong_self_knowledge','q3_avoidant_needs_grounding','q3_already_strategic'];
q3ids.forEach(id => {
  q3Section.appendChild(makeCard('Q3', 'bg-q3', id, `
    <div class="question-text border-q3">${QUESTIONS[id].text}</div>
  `));
});
q3Section.appendChild(makeCard('Prompt', 'bg-q3', 'Q3 System Prompt (shared by all Q3 variants)', `
  <div class="prompt-block">
    <div class="prompt-label">System Prompt &mdash; includes Q1+Q2 context</div>
    <div class="prompt-text">${highlightPrompt(PROMPTS.q3)}</div>
  </div>
`));
container.appendChild(q3Section);

/* ======= Q4 Section ======= */
const q4Section = $('div', 'section');
q4Section.id = 'q4';
q4Section.innerHTML = `
  <h2 class="section-title">Step 4 — Synthesis</h2>
  <p class="section-subtitle">AI generates non-obvious career insights from full conversation.
    No question bank — the Q3 AI reaction's last sentence becomes the Q4 prompt.</p>
`;
q4Section.appendChild(makeCard('Prompt', 'bg-q4', 'Q4 System Prompt — the key synthesis step', `
  <div class="prompt-block">
    <div class="prompt-label">System Prompt &mdash; full conversation context, plain-text output</div>
    <div class="prompt-text">${highlightPrompt(PROMPTS.q4)}</div>
  </div>
`, true));
container.appendChild(q4Section);

/* ======= Q5 Section ======= */
const q5Section = $('div', 'section');
q5Section.id = 'q5';
q5Section.innerHTML = `
  <h2 class="section-title">Step 5 — Final Deliverable</h2>
  <p class="section-subtitle">Student reacts to synthesis, AI generates structured output + invitation.</p>
`;
q5Section.appendChild(makeCard('Prompt', 'bg-q5', 'Q5 System Prompt — final structured output', `
  <div class="prompt-block">
    <div class="prompt-label">System Prompt &mdash; generates deliverable sections + invitation A/B/C</div>
    <div class="prompt-text">${highlightPrompt(PROMPTS.q5)}</div>
  </div>
`, true));
container.appendChild(q5Section);

</script>
</body>
</html>
